version: "3.8"

services:
  # .NET API
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: amethral-api
    environment:
      # Database Connection (use your external database)
      ConnectionStrings__DefaultConnection: "${DATABASE_URL}"

      # ASP.NET Core Configuration
      ASPNETCORE_ENVIRONMENT: ${ASPNETCORE_ENVIRONMENT:-Production}
      ASPNETCORE_URLS: http://+:80

      # Frontend URL for CORS
      FrontendUrl: ${FRONTEND_URL:-http://localhost:4200}

      # JWT Settings
      JwtSettings__SecretKey: ${JWT_SECRET_KEY}
      JwtSettings__Issuer: ${JWT_ISSUER:-Amethral}
      JwtSettings__Audience: ${JWT_AUDIENCE:-AmethralAPI}

      # OAuth Settings
      OAuth__Google__ClientId: ${GOOGLE_CLIENT_ID}
      OAuth__Google__ClientSecret: ${GOOGLE_CLIENT_SECRET}
      OAuth__Discord__ClientId: ${DISCORD_CLIENT_ID}
      OAuth__Discord__ClientSecret: ${DISCORD_CLIENT_SECRET}

    networks:
      - coolify
    expose:
      - "80"
    ports:
      - "${API_PORT:-3003}:80"

    restart: unless-stopped

networks:
  coolify:
    external: true
